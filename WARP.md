# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Repository Overview

This is a personal NixOS configuration repository using Flakes and Home Manager. The configuration manages both system-level packages (via NixOS) and user-level packages/programs (via Home Manager).

## Architecture

### Configuration Structure

The repository follows a modular NixOS Flake structure:

- **flake.nix**: Entry point that defines two main outputs:
  - `nixosConfigurations.default`: System-level configuration
  - `homeConfigurations."officialrajdeepsingh@nixos"`: User-level Home Manager configuration
- **configuration.nix**: System-level configuration (bootloader, networking, services, system packages)
- **home.nix**: User-level packages and programs managed by Home Manager
- **hardware-configuration.nix**: Hardware-specific configuration (auto-generated by NixOS)
- **programs/**: User programs configuration (zsh, neovim via nvf)
- **services/**: System services configuration (openssh, postgresql, virtualbox)

### Key Design Patterns

1. **Modular imports**: Both `programs/` and `services/` directories use `default.nix` to import individual configuration modules
2. **Flake inputs**: Uses nixpkgs-unstable, home-manager, and nvf (Neovim configuration framework)
3. **Dual configuration system**: System packages in `configuration.nix`, user packages in `home.nix`
4. **Desktop environment**: GNOME with customized package exclusions
5. **Container runtime**: Both Docker (rootless) and Podman configured

## Essential Commands

### Building and Switching Configurations

```bash
# Build and activate NixOS system configuration
sudo nixos-rebuild switch --flake ~/dotfiles/#default

# Test NixOS configuration without persisting
sudo nixos-rebuild test --flake ~/dotfiles/#default

# Build and activate Home Manager configuration
home-manager switch --flake ~/dotfiles#officialrajdeepsingh@nixos

# Alternative Home Manager command (legacy method)
home-manager switch -f ~/dotfiles/home.nix

# Update all flake inputs and rebuild
sudo nixos-rebuild switch --upgrade --flake ~/dotfiles/#default
```

### Shell Aliases

The following aliases are defined in `programs/zsh.nix`:

```bash
home          # home-manager switch --flake ~/dotfiles#officialrajdeepsingh@nixos
build         # sudo nixos-rebuild switch --flake ~/dotfiles/#default
build-test    # sudo nixos-rebuild test --flake ~/dotfiles/#default
upgrade       # sudo nixos-rebuild switch --upgrade --flake ~/dotfiles/#default
rm-home       # home-manager remove-generations
li-home       # home-manager generations
rm-nixos      # sudo nix-env --profile /nix/var/nix/profiles/system --delete-generations
li-nixos      # sudo nix-env --list-generations --profile /nix/var/nix/profiles/system
```

### Package Management

```bash
# Query installed packages
nix-store --query --requisites /run/current-system | cut -d- -f2- | sort | uniq

# Update flake.lock
nix flake update ~/dotfiles

# Check flake configuration
nix flake check ~/dotfiles

# Show flake outputs
nix flake show ~/dotfiles
```

### Development Environment

```bash
# Node.js version management (using fnm)
fnm install <version>    # Install Node.js version
fnm use <version>        # Use specific Node.js version
fnm current              # Show current Node.js version

# The configuration auto-switches Node versions on directory change
# via "fnm env --use-on-cd" in zsh.nix
```

## Important Configuration Details

### User and System Settings

- **Username**: `officialrajdeepsingh`
- **Hostname**: `nixos`
- **Timezone**: `Asia/Kolkata`
- **Locale**: `en_IN`
- **Default shell**: Zsh (configured system-wide)
- **Default editor**: `zeditor` (Zed editor)
- **State versions**: NixOS 23.05, Home Manager 23.11

### Enabled Features

- **Nix experimental features**: `nix-command` and `flakes` enabled
- **Unfree packages**: Allowed in both NixOS and Home Manager
- **Container runtimes**: Docker (rootless) and Podman
- **Desktop**: GNOME with GDM
- **Audio**: PipeWire with ALSA and PulseAudio compatibility
- **Virtualization**: Docker, Podman, and VirtualBox
- **Services**: OpenSSH, PostgreSQL, Flatpak

### Development Tools Installed

**Languages**: Rust (via rustup), Python 3, Zig, Lua, C/C++ (gcc)
**JavaScript/Node.js**: fnm, Deno, pnpm, yarn
**Editors**: Zed Editor, Helix, Neovim (via nvf)
**Version Control**: git, git-lfs, gh, lazygit, act
**Containers**: kubectl, Docker, Podman, dive, podman-tui
**Utilities**: ripgrep, fd, fzf, bat, jq, zoxide, curl, wget, ffmpeg, yt-dlp

### Neovim Configuration (nvf)

Neovim is configured via the nvf framework in `programs/neovim.nix`:
- **Theme**: Tokyo Night (night style)
- **LSP**: Enabled with inlay hints and null-ls
- **Autocompletion**: blink-cmp with friendly-snippets
- **Languages**: Bash, CSS, HTML, Lua, Tailwind, TypeScript, YAML, Zig
- **Features**: autopairs, comments, git integration, treesitter

## Modifying Configurations

### Adding System Packages

Edit `configuration.nix` and add packages to `environment.systemPackages`, then run:
```bash
sudo nixos-rebuild switch --flake ~/dotfiles/#default
```

### Adding User Packages

Edit `home.nix` and add packages to `home.packages`, then run:
```bash
home-manager switch --flake ~/dotfiles#officialrajdeepsingh@nixos
```

### Adding New Program Configurations

1. Create a new `.nix` file in `programs/` directory
2. Add the import to `programs/default.nix`
3. Rebuild Home Manager configuration

### Adding System Services

1. Create a new `.nix` file in `services/` directory
2. Add the import to `services/default.nix`
3. Rebuild NixOS configuration

## Flake Structure Details

The flake uses three main inputs:
- **nixpkgs**: NixOS package repository (unstable channel)
- **home-manager**: User environment manager
- **nvf**: Neovim configuration framework (notashelf/nvf)

All inputs follow the same nixpkgs version to ensure compatibility.
